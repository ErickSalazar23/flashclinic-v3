(()=>{var e={};e.id=252,e.ids=[252],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},7716:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,pages:()=>l,routeModule:()=>u,tree:()=>d});var a=r(260),s=r(8203),o=r(5155),i=r.n(o),n=r(7292),c={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);r.d(t,c);let d=["",{children:["(main)",{children:["prospects",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,7467)),"C:\\Users\\USER\\Proyectos Personales Software\\v3-saas-factory\\saas-factory-setup\\saas-factory\\src\\app\\(main)\\prospects\\new\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,8179)),"C:\\Users\\USER\\Proyectos Personales Software\\v3-saas-factory\\saas-factory-setup\\saas-factory\\src\\app\\(main)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,1485,23)),"next/dist/client/components/unauthorized-error"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,1354)),"C:\\Users\\USER\\Proyectos Personales Software\\v3-saas-factory\\saas-factory-setup\\saas-factory\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,1485,23)),"next/dist/client/components/unauthorized-error"]}],l=["C:\\Users\\USER\\Proyectos Personales Software\\v3-saas-factory\\saas-factory-setup\\saas-factory\\src\\app\\(main)\\prospects\\new\\page.tsx"],p={require:r,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/(main)/prospects/new/page",pathname:"/prospects/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},1851:(e,t,r)=>{"use strict";r.r(t),r.d(t,{"407049f2671c9da57f166ed5f782b455f28040e201":()=>n,"40c307f08d08f45d357246b8f25b0f594b4d0babfa":()=>c,"40ef025934db14cc939b03ec1dc9819dcc563bf895":()=>p,"40f27612fab4ffc97630191762bfe3bae57b2388b1":()=>d,"6094777ce2ff50ff62fe9e922325f1eb91e796c075":()=>l});var a=r(1590);r(376);var s=r(5687);let o={semanasAnuales:48,monedaSimbolo:"â‚¬",monedaCodigo:"EUR",thresholds:{critical:40,severe:25,moderate:15}};class i{constructor(e=o){this.settings=e}analyze(e){let t={id:`diag_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,prospectId:e.prospectId,calculatedAt:new Date().toISOString(),citasSemanales:e.citasSemanales||0,ticketPromedio:e.ticketPromedio||0,noShowPercentage:e.noShowPercentage||0,slotsDisponibles:e.slotsDisponibles||0,horasConsulta:e.horasConsulta||0,sillaVaciaPercentage:0,rentabilidadPercentage:0,perdidaAnual:0,perdidaNoShow:0,costoOportunidad:0,citasCompletadas:0,ingresoActual:0,ingresoPotencial:0,severity:"stable",severityScore:0,diagnosticText:"",recommendations:[]};return this.calculateMetrics(t),this.calculateSeverity(t),t.diagnosticText=this.generateDiagnosticText(t),t.recommendations=this.generateRecommendations(t),t}calculateMetrics(e){let{citasSemanales:t,ticketPromedio:r,noShowPercentage:a,slotsDisponibles:s}=e;e.citasCompletadas=t*(1-a/100),e.perdidaNoShow=a/100*t*r*this.settings.semanasAnuales;let o=Math.max(0,s-t);e.sillaVaciaPercentage=s>0?o/s*100:0,e.costoOportunidad=o*r*this.settings.semanasAnuales,e.perdidaAnual=e.perdidaNoShow+e.costoOportunidad,e.ingresoActual=e.citasCompletadas*r*this.settings.semanasAnuales,e.ingresoPotencial=s*r*this.settings.semanasAnuales,e.rentabilidadPercentage=e.ingresoPotencial>0?e.ingresoActual/e.ingresoPotencial*100:0}calculateSeverity(e){let t=e.ingresoPotencial>0?e.perdidaAnual/e.ingresoPotencial*100:0,r=e.sillaVaciaPercentage,a=e.noShowPercentage;e.severityScore=.5*t+.3*r+.2*a;let{thresholds:s}=this.settings;e.severityScore>=s.critical?e.severity="critical":e.severityScore>=s.severe?e.severity="severe":e.severityScore>=s.moderate?e.severity="moderate":e.severity="stable"}generateDiagnosticText(e){let{severity:t}=e,r="";switch(t){case"critical":r+="\uD83D\uDEA8 **HEMORRAGIA CR\xcdTICA DETECTADA**\n\n**ESTADO**: P\xe9rdida masiva de recursos. Intervenci\xf3n inmediata requerida.\n\n";break;case"severe":r+="âš ï¸ **HEMORRAGIA SEVERA EN CURSO**\n\n**ESTADO**: Sangrado significativo de ingresos. Tratamiento urgente necesario.\n\n";break;case"moderate":r+="âš¡ **HEMORRAGIA MODERADA IDENTIFICADA**\n\n**ESTADO**: P\xe9rdida controlable pero persistente. Intervenci\xf3n recomendada.\n\n";break;default:r+="âœ“ **OPERACI\xd3N ESTABLE**\n\n**ESTADO**: Flujo de ingresos saludable. Optimizaci\xf3n preventiva disponible.\n\n"}return r+=`## ðŸ“Š AN\xc1LISIS DE HEMORRAGIA FINANCIERA

**P\xe9rdida Anual Total**: ${this.formatCurrency(e.perdidaAnual)}
- P\xe9rdida por No-Show: ${this.formatCurrency(e.perdidaNoShow)}
- Costo de Oportunidad (Sillas Vac\xedas): ${this.formatCurrency(e.costoOportunidad)}

## ðŸ¥ AN\xc1LISIS DE CAPACIDAD OPERATIVA

**Silla Vac\xeda**: ${e.sillaVaciaPercentage.toFixed(1)}%
**Rentabilidad Actual**: ${e.rentabilidadPercentage.toFixed(1)}%
**Tasa de No-Show**: ${e.noShowPercentage.toFixed(1)}%

## ðŸ’° AN\xc1LISIS DE INGRESOS

**Ingreso Actual Anual**: ${this.formatCurrency(e.ingresoActual)}
**Ingreso Potencial Anual**: ${this.formatCurrency(e.ingresoPotencial)}
**Brecha de Ingresos**: ${this.formatCurrency(e.perdidaAnual)}

## ðŸ©º INTERPRETACI\xd3N CL\xcdNICA

`,"critical"===t?r+=`La pr\xe1ctica presenta una **hemorragia cr\xedtica de recursos**. Con ${e.sillaVaciaPercentage.toFixed(0)}% de capacidad sin utilizar y ${e.noShowPercentage.toFixed(0)}% de no-shows. Cada d\xeda sin intervenci\xf3n representa una hemorragia continua de ${this.formatCurrency(e.perdidaAnual/365)} diarios.

`:"severe"===t?r+=`La pr\xe1ctica sufre **sangrado severo de ingresos**. Tratamiento urgente puede recuperar ${this.formatCurrency(e.perdidaAnual)} anuales.

`:"moderate"===t?r+=`La pr\xe1ctica presenta **hemorragia moderada pero persistente**. Intervenci\xf3n preventiva puede capturar ${this.formatCurrency(e.perdidaAnual)} adicionales anuales.

`:r+="La pr\xe1ctica mantiene **operaci\xf3n saludable**. Oportunidades de mejora incremental disponibles.\n\n",r}generateRecommendations(e){let t=[],{severity:r}=e;return"critical"===r&&(t.push({priority:"critical",title:"Implementaci\xf3n Inmediata de Sistema de Confirmaci\xf3n",description:`Reducir no-shows del ${e.noShowPercentage.toFixed(0)}% al 5% mediante recordatorios automatizados`,impact:this.formatCurrency(.75*e.perdidaNoShow)}),t.push({priority:"critical",title:"Optimizaci\xf3n de Agenda y Overbooking Estrat\xe9gico",description:"Eliminar sillas vac\xedas mediante gesti\xf3n predictiva de capacidad",impact:this.formatCurrency(.6*e.costoOportunidad)})),"severe"===r&&t.push({priority:"high",title:"Protocolo Anti-NoShow",description:"Implementar confirmaci\xf3n 48h antes + recordatorio 24h antes",impact:this.formatCurrency(.6*e.perdidaNoShow)}),t.push({priority:"low",title:"Dashboard de M\xe9tricas en Tiempo Real",description:"Monitoreo continuo de KPIs operativos para detecci\xf3n temprana",impact:"Prevenci\xf3n de hemorragias futuras"}),t}formatCurrency(e){return new Intl.NumberFormat("es-CO",{style:"currency",currency:this.settings.monedaCodigo,minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}}async function n(e={}){try{let t=(await (0,s.U)()).from("prospects").select("*").order("updated_at",{ascending:!1});e.stage&&(t=t.eq("stage",e.stage));let{data:r,error:a}=await t;if(a)return console.error("Error fetching prospects:",a),{ok:!1,error:a.message};let o=(r||[]).map(u);return{ok:!0,data:o}}catch(e){return console.error("Unexpected error:",e),{ok:!1,error:"Error inesperado al cargar prospectos"}}}async function c(e){try{let t=await (0,s.U)(),{data:r,error:a}=await t.from("prospects").select("*").eq("id",e).single();if(a)return console.error("Error fetching prospect:",a),{ok:!1,error:a.message};return{ok:!0,data:u(r)}}catch(e){return console.error("Unexpected error:",e),{ok:!1,error:"Error inesperado al cargar prospecto"}}}async function d(e){try{let t=await (0,s.U)(),{data:{user:r}}=await t.auth.getUser();if(!r)return{ok:!1,error:"No autorizado"};let a=new i().analyze({prospectId:"temp",citasSemanales:e.citasSemanales,ticketPromedio:e.ticketPromedio,noShowPercentage:e.noShowPercentage,slotsDisponibles:e.slotsDisponibles,horasConsulta:e.horasConsulta}),{data:o,error:n}=await t.from("prospects").insert({user_id:r.id,doctor_name:e.doctorName,specialty:e.specialty,clinic_name:e.clinicName,phone:e.phone,email:e.email,city:e.city,citas_semanales:e.citasSemanales,ticket_promedio:e.ticketPromedio,no_show_percentage:e.noShowPercentage,slots_disponibles:e.slotsDisponibles,horas_consulta:e.horasConsulta,stage:"agenda_detenida",notes:e.notes||"",diagnostic_severity:a.severity,diagnostic_perdida_anual:a.perdidaAnual,diagnostic_text:a.diagnosticText,diagnostic_recommendations:a.recommendations,deal_value:.1*a.perdidaAnual,ltv:.3*a.perdidaAnual}).select().single();if(n)return console.error("Error creating prospect:",n),{ok:!1,error:n.message};return{ok:!0,data:u(o)}}catch(e){return console.error("Unexpected error:",e),{ok:!1,error:"Error inesperado al crear prospecto"}}}async function l(e,t){try{let r=await (0,s.U)(),{data:a,error:o}=await r.from("prospects").update({stage:t,stage_updated_at:new Date().toISOString(),updated_at:new Date().toISOString(),closed_at:"recuperacion_exitosa"===t?new Date().toISOString():null}).eq("id",e).select().single();if(o)return console.error("Error updating prospect stage:",o),{ok:!1,error:o.message};return{ok:!0,data:u(a)}}catch(e){return console.error("Unexpected error:",e),{ok:!1,error:"Error inesperado al actualizar prospecto"}}}async function p(e){try{let t=await (0,s.U)(),{error:r}=await t.from("prospects").delete().eq("id",e);if(r)return console.error("Error deleting prospect:",r),{ok:!1,error:r.message};return{ok:!0,data:void 0}}catch(e){return console.error("Unexpected error:",e),{ok:!1,error:"Error inesperado al eliminar prospecto"}}}function u(e){let t=e.diagnostic_severity?{id:`diag_${e.id}`,prospectId:e.id,calculatedAt:e.updated_at,citasSemanales:e.citas_semanales,ticketPromedio:e.ticket_promedio,noShowPercentage:e.no_show_percentage,slotsDisponibles:e.slots_disponibles,horasConsulta:e.horas_consulta,sillaVaciaPercentage:0,rentabilidadPercentage:0,perdidaAnual:e.diagnostic_perdida_anual||0,perdidaNoShow:0,costoOportunidad:0,citasCompletadas:0,ingresoActual:0,ingresoPotencial:0,severity:e.diagnostic_severity,severityScore:0,diagnosticText:e.diagnostic_text||"",recommendations:e.diagnostic_recommendations||[]}:null;return{id:e.id,createdAt:e.created_at,updatedAt:e.updated_at,doctorName:e.doctor_name,specialty:e.specialty,clinicName:e.clinic_name,phone:e.phone,email:e.email,city:e.city,citasSemanales:e.citas_semanales,ticketPromedio:e.ticket_promedio,noShowPercentage:e.no_show_percentage,slotsDisponibles:e.slots_disponibles,horasConsulta:e.horas_consulta,stage:e.stage,stageUpdatedAt:e.stage_updated_at,diagnostic:t,dealValue:e.deal_value||0,ltv:e.ltv||0,closedAt:e.closed_at,activities:[],notes:e.notes||"",nextFollowUp:e.next_follow_up}}(0,r(9344).D)([n,c,d,l,p]),(0,a.A)(n,"407049f2671c9da57f166ed5f782b455f28040e201",null),(0,a.A)(c,"40c307f08d08f45d357246b8f25b0f594b4d0babfa",null),(0,a.A)(d,"40f27612fab4ffc97630191762bfe3bae57b2388b1",null),(0,a.A)(l,"6094777ce2ff50ff62fe9e922325f1eb91e796c075",null),(0,a.A)(p,"40ef025934db14cc939b03ec1dc9819dcc563bf895",null)},6925:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,3219,23)),Promise.resolve().then(r.t.bind(r,4863,23)),Promise.resolve().then(r.t.bind(r,5155,23)),Promise.resolve().then(r.t.bind(r,802,23)),Promise.resolve().then(r.t.bind(r,9350,23)),Promise.resolve().then(r.t.bind(r,8530,23)),Promise.resolve().then(r.t.bind(r,8921,23))},541:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,6959,23)),Promise.resolve().then(r.t.bind(r,3875,23)),Promise.resolve().then(r.t.bind(r,8903,23)),Promise.resolve().then(r.t.bind(r,7174,23)),Promise.resolve().then(r.t.bind(r,4178,23)),Promise.resolve().then(r.t.bind(r,7190,23)),Promise.resolve().then(r.t.bind(r,1365,23))},2939:(e,t,r)=>{Promise.resolve().then(r.bind(r,7467))},9379:(e,t,r)=>{Promise.resolve().then(r.bind(r,1046))},8717:()=>{},2685:()=>{},9334:(e,t,r)=>{"use strict";var a=r(8686);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},1046:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(5512);r(8657),r(1760);var s=r(1152),o=r(9334),i=r(8531),n=r.n(i);function c(){let e=(0,o.useRouter)();return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(n(),{href:"/prospects",className:"p-2 rounded-lg hover:bg-slate-800 transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Nuevo Prospecto"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:"Ingresa los datos del nuevo prospecto para an\xe1lisis diagn\xf3stico"})]})]}),(0,a.jsx)(s.ProspectForm,{onSuccess:()=>e.push("/prospects"),onCancel:()=>e.back()})]})}},3746:(e,t,r)=>{"use strict";r.d(t,{U:()=>s});var a=r(6181);function s(){return(0,a.createBrowserClient)("https://yrlxpabmxezbcftxqivs.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlybHhwYWJteGV6YmNmdHhxaXZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NjI5NzEsImV4cCI6MjA4NTEzODk3MX0.6Rh8UKoGJfRKkxaZ8jeWzeRB0D81ViY0fKCt-A8ucLg")}},7467:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(6760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\USER\\\\Proyectos Personales Software\\\\v3-saas-factory\\\\saas-factory-setup\\\\saas-factory\\\\src\\\\app\\\\(main)\\\\prospects\\\\new\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\USER\\Proyectos Personales Software\\v3-saas-factory\\saas-factory-setup\\saas-factory\\src\\app\\(main)\\prospects\\new\\page.tsx","default")},1354:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o,metadata:()=>s});var a=r(2740);r(1135);let s={title:"Flash Clinic V3",description:"Motor de Adquisici\xf3n M\xe9dica"};function o({children:e}){return(0,a.jsx)("html",{lang:"es",children:(0,a.jsx)("body",{className:"antialiased",children:e})})}},5687:(e,t,r)=>{"use strict";r.d(t,{U:()=>o});var a=r(6876),s=r(2385);async function o(){let e=await (0,s.UL)();return(0,a.createServerClient)("https://yrlxpabmxezbcftxqivs.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlybHhwYWJteGV6YmNmdHhxaXZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NjI5NzEsImV4cCI6MjA4NTEzODk3MX0.6Rh8UKoGJfRKkxaZ8jeWzeRB0D81ViY0fKCt-A8ucLg",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:a})=>e.set(t,r,a))}catch{}}}})}},1135:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,403,531,181,996,442],()=>r(7716));module.exports=a})();