(()=>{var e={};e.id=725,e.ids=[725],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},8084:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>n.a,__next_app__:()=>p,pages:()=>l,routeModule:()=>u,tree:()=>d});var a=t(260),o=t(8203),s=t(5155),n=t.n(s),i=t(7292),c={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);t.d(r,c);let d=["",{children:["(main)",{children:["prospects",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,3414)),"C:\\Users\\USER\\Proyectos Personales Software\\v3-saas-factory\\saas-factory-setup\\saas-factory\\src\\app\\(main)\\prospects\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,8179)),"C:\\Users\\USER\\Proyectos Personales Software\\v3-saas-factory\\saas-factory-setup\\saas-factory\\src\\app\\(main)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,9116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,1485,23)),"next/dist/client/components/unauthorized-error"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,1354)),"C:\\Users\\USER\\Proyectos Personales Software\\v3-saas-factory\\saas-factory-setup\\saas-factory\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,9116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,1485,23)),"next/dist/client/components/unauthorized-error"]}],l=["C:\\Users\\USER\\Proyectos Personales Software\\v3-saas-factory\\saas-factory-setup\\saas-factory\\src\\app\\(main)\\prospects\\page.tsx"],p={require:t,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:o.RouteKind.APP_PAGE,page:"/(main)/prospects/page",pathname:"/prospects",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},5825:(e,r,t)=>{"use strict";t.r(r),t.d(r,{"407049f2671c9da57f166ed5f782b455f28040e201":()=>a.kq,"40c307f08d08f45d357246b8f25b0f594b4d0babfa":()=>a.tZ,"40ef025934db14cc939b03ec1dc9819dcc563bf895":()=>a._Z,"40f27612fab4ffc97630191762bfe3bae57b2388b1":()=>a.NW,"6094777ce2ff50ff62fe9e922325f1eb91e796c075":()=>a.MG});var a=t(3966)},5021:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,9607,23)),Promise.resolve().then(t.bind(t,8031)),Promise.resolve().then(t.bind(t,2291)),Promise.resolve().then(t.bind(t,3519)),Promise.resolve().then(t.bind(t,6886)),Promise.resolve().then(t.bind(t,5937))},8637:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,8531,23)),Promise.resolve().then(t.bind(t,1760)),Promise.resolve().then(t.bind(t,8657)),Promise.resolve().then(t.bind(t,1152)),Promise.resolve().then(t.bind(t,3850)),Promise.resolve().then(t.bind(t,3157))},6248:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{callServer:function(){return a.callServer},createServerReference:function(){return s},findSourceMapURL:function(){return o.findSourceMapURL}});let a=t(7295),o=t(2035),s=t(8832).createServerReference},9607:(e,r,t)=>{let{createProxy:a}=t(3439);e.exports=a("C:\\Users\\USER\\Proyectos Personales Software\\v3-saas-factory\\saas-factory-setup\\saas-factory\\node_modules\\next\\dist\\client\\app-dir\\link.js")},3966:(e,r,t)=>{"use strict";t.d(r,{NW:()=>d,_Z:()=>p,tZ:()=>c,kq:()=>i,MG:()=>l});var a=t(8977);t(8063);var o=t(5546);let s={semanasAnuales:48,monedaSimbolo:"â‚¬",monedaCodigo:"EUR",thresholds:{critical:40,severe:25,moderate:15}};class n{constructor(e=s){this.settings=e}analyze(e){let r={id:`diag_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,prospectId:e.prospectId,calculatedAt:new Date().toISOString(),citasSemanales:e.citasSemanales||0,ticketPromedio:e.ticketPromedio||0,noShowPercentage:e.noShowPercentage||0,slotsDisponibles:e.slotsDisponibles||0,horasConsulta:e.horasConsulta||0,sillaVaciaPercentage:0,rentabilidadPercentage:0,perdidaAnual:0,perdidaNoShow:0,costoOportunidad:0,citasCompletadas:0,ingresoActual:0,ingresoPotencial:0,severity:"stable",severityScore:0,diagnosticText:"",recommendations:[]};return this.calculateMetrics(r),this.calculateSeverity(r),r.diagnosticText=this.generateDiagnosticText(r),r.recommendations=this.generateRecommendations(r),r}calculateMetrics(e){let{citasSemanales:r,ticketPromedio:t,noShowPercentage:a,slotsDisponibles:o}=e;e.citasCompletadas=r*(1-a/100),e.perdidaNoShow=a/100*r*t*this.settings.semanasAnuales;let s=Math.max(0,o-r);e.sillaVaciaPercentage=o>0?s/o*100:0,e.costoOportunidad=s*t*this.settings.semanasAnuales,e.perdidaAnual=e.perdidaNoShow+e.costoOportunidad,e.ingresoActual=e.citasCompletadas*t*this.settings.semanasAnuales,e.ingresoPotencial=o*t*this.settings.semanasAnuales,e.rentabilidadPercentage=e.ingresoPotencial>0?e.ingresoActual/e.ingresoPotencial*100:0}calculateSeverity(e){let r=e.ingresoPotencial>0?e.perdidaAnual/e.ingresoPotencial*100:0,t=e.sillaVaciaPercentage,a=e.noShowPercentage;e.severityScore=.5*r+.3*t+.2*a;let{thresholds:o}=this.settings;e.severityScore>=o.critical?e.severity="critical":e.severityScore>=o.severe?e.severity="severe":e.severityScore>=o.moderate?e.severity="moderate":e.severity="stable"}generateDiagnosticText(e){let{severity:r}=e,t="";switch(r){case"critical":t+="\uD83D\uDEA8 **HEMORRAGIA CR\xcdTICA DETECTADA**\n\n**ESTADO**: P\xe9rdida masiva de recursos. Intervenci\xf3n inmediata requerida.\n\n";break;case"severe":t+="âš ï¸ **HEMORRAGIA SEVERA EN CURSO**\n\n**ESTADO**: Sangrado significativo de ingresos. Tratamiento urgente necesario.\n\n";break;case"moderate":t+="âš¡ **HEMORRAGIA MODERADA IDENTIFICADA**\n\n**ESTADO**: P\xe9rdida controlable pero persistente. Intervenci\xf3n recomendada.\n\n";break;default:t+="âœ“ **OPERACI\xd3N ESTABLE**\n\n**ESTADO**: Flujo de ingresos saludable. Optimizaci\xf3n preventiva disponible.\n\n"}return t+=`## ðŸ“Š AN\xc1LISIS DE HEMORRAGIA FINANCIERA

**P\xe9rdida Anual Total**: ${this.formatCurrency(e.perdidaAnual)}
- P\xe9rdida por No-Show: ${this.formatCurrency(e.perdidaNoShow)}
- Costo de Oportunidad (Sillas Vac\xedas): ${this.formatCurrency(e.costoOportunidad)}

## ðŸ¥ AN\xc1LISIS DE CAPACIDAD OPERATIVA

**Silla Vac\xeda**: ${e.sillaVaciaPercentage.toFixed(1)}%
**Rentabilidad Actual**: ${e.rentabilidadPercentage.toFixed(1)}%
**Tasa de No-Show**: ${e.noShowPercentage.toFixed(1)}%

## ðŸ’° AN\xc1LISIS DE INGRESOS

**Ingreso Actual Anual**: ${this.formatCurrency(e.ingresoActual)}
**Ingreso Potencial Anual**: ${this.formatCurrency(e.ingresoPotencial)}
**Brecha de Ingresos**: ${this.formatCurrency(e.perdidaAnual)}

## ðŸ©º INTERPRETACI\xd3N CL\xcdNICA

`,"critical"===r?t+=`La pr\xe1ctica presenta una **hemorragia cr\xedtica de recursos**. Con ${e.sillaVaciaPercentage.toFixed(0)}% de capacidad sin utilizar y ${e.noShowPercentage.toFixed(0)}% de no-shows. Cada d\xeda sin intervenci\xf3n representa una hemorragia continua de ${this.formatCurrency(e.perdidaAnual/365)} diarios.

`:"severe"===r?t+=`La pr\xe1ctica sufre **sangrado severo de ingresos**. Tratamiento urgente puede recuperar ${this.formatCurrency(e.perdidaAnual)} anuales.

`:"moderate"===r?t+=`La pr\xe1ctica presenta **hemorragia moderada pero persistente**. Intervenci\xf3n preventiva puede capturar ${this.formatCurrency(e.perdidaAnual)} adicionales anuales.

`:t+="La pr\xe1ctica mantiene **operaci\xf3n saludable**. Oportunidades de mejora incremental disponibles.\n\n",t}generateRecommendations(e){let r=[],{severity:t}=e;return"critical"===t&&(r.push({priority:"critical",title:"Implementaci\xf3n Inmediata de Sistema de Confirmaci\xf3n",description:`Reducir no-shows del ${e.noShowPercentage.toFixed(0)}% al 5% mediante recordatorios automatizados`,impact:this.formatCurrency(.75*e.perdidaNoShow)}),r.push({priority:"critical",title:"Optimizaci\xf3n de Agenda y Overbooking Estrat\xe9gico",description:"Eliminar sillas vac\xedas mediante gesti\xf3n predictiva de capacidad",impact:this.formatCurrency(.6*e.costoOportunidad)})),"severe"===t&&r.push({priority:"high",title:"Protocolo Anti-NoShow",description:"Implementar confirmaci\xf3n 48h antes + recordatorio 24h antes",impact:this.formatCurrency(.6*e.perdidaNoShow)}),r.push({priority:"low",title:"Dashboard de M\xe9tricas en Tiempo Real",description:"Monitoreo continuo de KPIs operativos para detecci\xf3n temprana",impact:"Prevenci\xf3n de hemorragias futuras"}),r}formatCurrency(e){return new Intl.NumberFormat("es-CO",{style:"currency",currency:this.settings.monedaCodigo,minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}}async function i(e={}){try{let r=(await (0,o.U)()).from("prospects").select("*").order("updated_at",{ascending:!1});e.stage&&(r=r.eq("stage",e.stage));let{data:t,error:a}=await r;if(a)return console.error("Error fetching prospects:",a),{ok:!1,error:a.message};let s=(t||[]).map(u);return{ok:!0,data:s}}catch(e){return console.error("Unexpected error:",e),{ok:!1,error:"Error inesperado al cargar prospectos"}}}async function c(e){try{let r=await (0,o.U)(),{data:t,error:a}=await r.from("prospects").select("*").eq("id",e).single();if(a)return console.error("Error fetching prospect:",a),{ok:!1,error:a.message};return{ok:!0,data:u(t)}}catch(e){return console.error("Unexpected error:",e),{ok:!1,error:"Error inesperado al cargar prospecto"}}}async function d(e){try{let r=await (0,o.U)(),{data:{user:t}}=await r.auth.getUser();if(!t)return{ok:!1,error:"No autorizado"};let a=new n().analyze({prospectId:"temp",citasSemanales:e.citasSemanales,ticketPromedio:e.ticketPromedio,noShowPercentage:e.noShowPercentage,slotsDisponibles:e.slotsDisponibles,horasConsulta:e.horasConsulta}),{data:s,error:i}=await r.from("prospects").insert({user_id:t.id,doctor_name:e.doctorName,specialty:e.specialty,clinic_name:e.clinicName,phone:e.phone,email:e.email,city:e.city,citas_semanales:e.citasSemanales,ticket_promedio:e.ticketPromedio,no_show_percentage:e.noShowPercentage,slots_disponibles:e.slotsDisponibles,horas_consulta:e.horasConsulta,stage:"agenda_detenida",notes:e.notes||"",diagnostic_severity:a.severity,diagnostic_perdida_anual:a.perdidaAnual,diagnostic_text:a.diagnosticText,diagnostic_recommendations:a.recommendations,deal_value:.1*a.perdidaAnual,ltv:.3*a.perdidaAnual}).select().single();if(i)return console.error("Error creating prospect:",i),{ok:!1,error:i.message};return{ok:!0,data:u(s)}}catch(e){return console.error("Unexpected error:",e),{ok:!1,error:"Error inesperado al crear prospecto"}}}async function l(e,r){try{let t=await (0,o.U)(),{data:a,error:s}=await t.from("prospects").update({stage:r,stage_updated_at:new Date().toISOString(),updated_at:new Date().toISOString(),closed_at:"recuperacion_exitosa"===r?new Date().toISOString():null}).eq("id",e).select().single();if(s)return console.error("Error updating prospect stage:",s),{ok:!1,error:s.message};return{ok:!0,data:u(a)}}catch(e){return console.error("Unexpected error:",e),{ok:!1,error:"Error inesperado al actualizar prospecto"}}}async function p(e){try{let r=await (0,o.U)(),{error:t}=await r.from("prospects").delete().eq("id",e);if(t)return console.error("Error deleting prospect:",t),{ok:!1,error:t.message};return{ok:!0,data:void 0}}catch(e){return console.error("Unexpected error:",e),{ok:!1,error:"Error inesperado al eliminar prospecto"}}}function u(e){let r=e.diagnostic_severity?{id:`diag_${e.id}`,prospectId:e.id,calculatedAt:e.updated_at,citasSemanales:e.citas_semanales,ticketPromedio:e.ticket_promedio,noShowPercentage:e.no_show_percentage,slotsDisponibles:e.slots_disponibles,horasConsulta:e.horas_consulta,sillaVaciaPercentage:0,rentabilidadPercentage:0,perdidaAnual:e.diagnostic_perdida_anual||0,perdidaNoShow:0,costoOportunidad:0,citasCompletadas:0,ingresoActual:0,ingresoPotencial:0,severity:e.diagnostic_severity,severityScore:0,diagnosticText:e.diagnostic_text||"",recommendations:e.diagnostic_recommendations||[]}:null;return{id:e.id,createdAt:e.created_at,updatedAt:e.updated_at,doctorName:e.doctor_name,specialty:e.specialty,clinicName:e.clinic_name,phone:e.phone,email:e.email,city:e.city,citasSemanales:e.citas_semanales,ticketPromedio:e.ticket_promedio,noShowPercentage:e.no_show_percentage,slotsDisponibles:e.slots_disponibles,horasConsulta:e.horas_consulta,stage:e.stage,stageUpdatedAt:e.stage_updated_at,diagnostic:r,dealValue:e.deal_value||0,ltv:e.ltv||0,closedAt:e.closed_at,activities:[],notes:e.notes||"",nextFollowUp:e.next_follow_up}}(0,t(6215).D)([i,c,d,l,p]),(0,a.A)(i,"407049f2671c9da57f166ed5f782b455f28040e201",null),(0,a.A)(c,"40c307f08d08f45d357246b8f25b0f594b4d0babfa",null),(0,a.A)(d,"40f27612fab4ffc97630191762bfe3bae57b2388b1",null),(0,a.A)(l,"6094777ce2ff50ff62fe9e922325f1eb91e796c075",null),(0,a.A)(p,"40ef025934db14cc939b03ec1dc9819dcc563bf895",null)},3414:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u,dynamic:()=>l});var a=t(2740),o=t(6301),s=t(3966);t(2291);var n=t(8031);t(3519);var i=t(2595),c=t(9607),d=t.n(c);let l="force-dynamic";async function p(){let e=await (0,s.kq)();if(!e.ok)return(0,a.jsx)("div",{className:"rounded-md bg-red-500/10 border border-red-500/20 p-4",children:(0,a.jsxs)("p",{className:"text-sm text-red-400",children:["Error al cargar prospectos: ",e.error]})});let r=e.data;return 0===r.length?(0,a.jsx)(i.pp,{title:"Sin prospectos",description:"Comienza agregando tu primer prospecto al pipeline.",icon:(0,a.jsx)("svg",{className:"h-12 w-12 text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})}),action:(0,a.jsx)(d(),{href:"/prospects/new",className:"btn btn-primary",children:"Agregar Prospecto"})}):(0,a.jsx)(n.PipelineBoard,{prospects:r})}function u(){return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Pipeline de Prospectos"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:"Gestiona el ciclo de vida de tus prospectos m\xe9dicos"})]}),(0,a.jsx)(d(),{href:"/prospects/new",className:"btn btn-primary",children:"+ Nuevo Prospecto"})]}),(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)(i.WL,{message:"Cargando pipeline..."}),children:(0,a.jsx)(p,{})})]})}},8031:(e,r,t)=>{"use strict";t.d(r,{PipelineBoard:()=>a});let a=(0,t(6760).registerClientReference)(function(){throw Error("Attempted to call PipelineBoard() from the server but PipelineBoard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\USER\\Proyectos Personales Software\\v3-saas-factory\\saas-factory-setup\\saas-factory\\src\\features\\prospects\\components\\PipelineBoard.tsx","PipelineBoard")},2291:(e,r,t)=>{"use strict";t.d(r,{ProspectCard:()=>a});let a=(0,t(6760).registerClientReference)(function(){throw Error("Attempted to call ProspectCard() from the server but ProspectCard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\USER\\Proyectos Personales Software\\v3-saas-factory\\saas-factory-setup\\saas-factory\\src\\features\\prospects\\components\\ProspectCard.tsx","ProspectCard")},3519:(e,r,t)=>{"use strict";t.d(r,{ProspectForm:()=>a});let a=(0,t(6760).registerClientReference)(function(){throw Error("Attempted to call ProspectForm() from the server but ProspectForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\USER\\Proyectos Personales Software\\v3-saas-factory\\saas-factory-setup\\saas-factory\\src\\features\\prospects\\components\\ProspectForm.tsx","ProspectForm")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[638,403,531,181,969,73,442],()=>t(8084));module.exports=a})();